name: GodScore Enforcement Demo (Intentional Failure)

on:
  push:
  pull_request:

jobs:
  enforcement-demo:
    runs-on: ubuntu-latest

    # This is a DEMO job.
    # Its failure is intentional and should never block real CI.
    continue-on-error: true

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Generate demo signals
        run: |
          mkdir -p api/out
          cat > api/demo_signals.v1.json <<'EOF'
          {
            "version": "1.0.0",
            "signals": [
              {
                "id": "demo.constraint.violation",
                "type": "compliance",
                "severity": "high",
                "source": "demo",
                "ts": "2026-01-31T00:00:00Z",
                "message": "Intentional demo violation to trigger enforcement",
                "meta": {
                  "demo": true
                }
              }
            ]
          }
          EOF

      - name: Generate v1 output (demo mode)
        env:
          GODSCORE_SIGNALS_PATH: api/demo_signals.v1.json
          GODSCORE_DEMO_MODE: "true"
        run: |
          python api/generate_v1.py api/example_output.v1.json api/out/godscore.output.v1.json
          cat api/out/godscore.output.v1.json

      - name: Validate v1 output against contract
        run: |
          python api/validate_v1.py api/schema.v1.json api/out/godscore.output.v1.json

      - name: Intentional enforcement failure
        run: |
          echo "---------------------------------------------"
          echo "This job FAILS ON PURPOSE."
          echo "It demonstrates enforcement when constraints"
          echo "are violated."
          echo "---------------------------------------------"
          exit 1
